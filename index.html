<script>
  const music = document.getElementById("bgMusic");
  const toggleBtn = document.getElementById("musicToggle");

  /* ---------------- MUSIC SETUP (runs on page load) ---------------- */

  if (music && toggleBtn) {

    // Restore playback time
    const savedTime = localStorage.getItem("musicTime");
    if (savedTime) {
      music.currentTime = parseFloat(savedTime);
    }

    // Restore pause state
    const isPaused = localStorage.getItem("musicPaused") === "true";
    toggleBtn.textContent = isPaused ? "â–¶ Play" : "â¸ Pause";

    // Save playback time
    setInterval(() => {
      if (!music.paused) {
        localStorage.setItem("musicTime", music.currentTime);
      }
    }, 500);

    // Play / Pause button
    toggleBtn.onclick = (e) => {
      e.stopPropagation();

      if (music.paused) {
        music.play().then(() => {
          toggleBtn.textContent = "â¸ Pause";
          localStorage.setItem("musicPaused", "false");
        }).catch(()=>{});
      } else {
        music.pause();
        toggleBtn.textContent = "â–¶ Play";
        localStorage.setItem("musicPaused", "true");
      }
    };
  }

  /* ---------------- ENTER BUTTON ---------------- */

  function enterSurprise() {
    // Start music if not started
    if (music && music.paused) {
      music.play().catch(()=>{});
      localStorage.setItem("musicPaused", "false");
    }

    // Navigate
    setTimeout(() => {
      window.location.href = "wish.html";
    }, 300);
  }

  /* ---------------- BALLOONS (run once) ---------------- */

  const balloonContainer = document.querySelector(".balloon-container");
  if (balloonContainer) {
    const emojis = ["ðŸŽˆ","ðŸŽ‰","ðŸŽŠ"];
    for (let i = 0; i < 30; i++) {
      const b = document.createElement("span");
      b.className = "balloon";
      b.textContent = emojis[Math.floor(Math.random() * emojis.length)];
      b.style.left = Math.random() * 100 + "vw";
      b.style.fontSize = 20 + Math.random() * 30 + "px";
      b.style.animationDuration = 8 + Math.random() * 8 + "s";
      b.style.animationDelay = Math.random() * 5 + "s";
      balloonContainer.appendChild(b);
    }
  }
</script>
